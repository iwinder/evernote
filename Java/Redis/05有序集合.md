有序集合

编码可以是ziplist或者skiplist

## ziplist

使用压缩链表作为底层实现，每个集合的元素使用两个紧挨在一起的压缩链表节点来保存，第一个节点保存元素成员（member），第二个节点保存分值（score）

集合按分值从小到大排序，小的元素被放置在靠近表头的方向，较大的放置在靠近表尾的方向。

## skiplist

使用zset结构作为底层实现，一个zset结构同时包含一个字典和一个跳跃表。

### zsl跳跃表

- 按分值从小到大保存了所有集合元素
- 每个跳跃表节点保存了一个集合元素
- object属性保存元素成员
- score属性保存元素的分值

通过该表，程序可以对有序集合进行范围型操作。

### dict字典

- 为有序集合创建了一个从成员到分值的映射，每个键值对都保存了一个集合元素
- 键为元素成员
- 值为分值

两种数据结构都会通过指针来共享相同元素的成员和分值，所以不会产生任何重复成员或分值。

### 为何同时使用这两者进行实现

- 字典以无序的方式保存集合元素，所以每次在执行范围型操作，程序都要对字典保存的所有元素进行排序。
- 跳跃表适合执行范围型操作，当根据成员查找分值这一操作的复杂度将从O(1)上升为O(logN)。

## 编码转换

当有序集合同时满足以下两个条件时，对象使用ziplist编码:

- 有序集合保存的元素数量小于128个
- 有序集合保存的所有元素成员的长度都小于64字节

不能同时满足的有序集合对象使用skiplist编码。

以上两个条件的上限值是可以修改的，涉及到配置文件的选项
```sql
 zset-max-ziplist-entries
 zset-max-ziplist-value
```