---
title: 深拷贝与浅拷贝
tags: Java
grammar_cjkRuby: true
---

## 创建对象的方式

1、调用new语句创建对象，最常见的一种
2、运用反射手段创建对象,调用java.lang.Class 或者 java.lang.reflect.Constructor 类的newInstance()实例方法
3、调用对象的clone()方法
4、使用反序列化,调用java.io.ObjectInputStream 对象的 readObject()方法.

## 将一个对象的引用复制给另外一个对象的方法

1、直接赋值
2、浅拷贝
3、深拷贝

### 直接赋值
实体类Person.java
```
public class Person {
    //姓名
    private String name;
    // 年龄
    private int age;
    // 编号
    private Integer code;

    public Person(){

    }
	
    public Person(String name, int age, Integer code) {
        this.name = name;
        this.age = age;
        this.code = code;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

}
```
测试类cloneDemo.java

本篇所有测试均会在该类下完成
```
public class cloneDemo {
    public static void main(String[] args) {
        Person p = new Person("小明",11,123);
        Person p1 = p;
        System.out.println(p);
        System.out.println(p1);
    }
}
```
打印结果：
```
Others.base.cloneDemo.Person@4554617c
Others.base.cloneDemo.Person@4554617c
```
两者打印出来的地址相同，可见二者的引用是同一个对象，并没有创建出一个新的对象。可以把这种现象叫做引用的复制（或引用拷贝）。

对Person.java追加toString方法，
```
    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", code=" + code +
                '}';
    }
```
cloneDemo.java中追加
```
        p1.setCode(1234);
        System.out.println("------------------");
        System.out.println(p);
        System.out.println(p1);
```
从打印结果中更能体现出这一点,因为是同一个对象的引用，所以两者改一个，另一个对象的值也随之改变：
```
Person{name='小明', age=11, code=123}
Person{name='小明', age=11, code=123}
------------------
Person{name='小明', age=11, code=1234}
Person{name='小明', age=11, code=1234}
```
### 浅拷贝
浅拷贝是按位拷贝对象，它会创建一个新对象，这个对象有着原始对象属性值的一份精确拷贝。

如果属性是基本类型，拷贝的就是基本类型的值；

如果属性是内存地址（引用类型），拷贝的就是内存地址（即复制引用但不复制引用的对象） ，因此如果其中一个对象改变了这个地址，就会影响到另一个对象。

**实现对象拷贝的类，必须实现Cloneable接口，并覆写clone()方法**。 

下面改造Person.java
```
/**
 * 实现对象拷贝的类，必须实现Cloneable接口，并覆写clone()方法
 */
public class Person implements Cloneable{
    //姓名
    private String name;
    // 年龄
    private int age;
    // 编号
    private Integer code;

    public Person(){

    }

    public Person(String name, int age, Integer code) {
        this.name = name;
        this.age = age;
        this.code = code;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    @Override
    public String toString() {
        return "Person{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", code=" + code +
                '}';
    }

    /**
     * 覆写clone()方法
     * @return
     * @throws CloneNotSupportedException
     */
    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```
cloneDemo.java中追加
```
        Person p2 = p;
        p2.setName("小明克隆人");
        p2.setAge(12);
        p2.setCode(12345);
        System.out.println(p);
        System.out.println(p2);
        System.out.println("------------------");
```
得到结果：
```
Person{name='小明', age=11, code=1234}
Person{name='小明克隆人', age=12, code=12345}
```

此时p2完成了一次拷贝。现在继续改造Person，添加一个Address对象。
Address.java

```
public class Address {
    private String name;

    public Address( ) {

    }

    public Address(String name) {
        this.name = name;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override
    public String toString() {
        return "Student{" +
                "name='" + name + '\'' +
                '}';
    }
}
```
Person.java中添加对应属性
```
private Address address;
public Address getAddress() {
	return address;
}

public void setAddress(Address address) {
	this.address = address;
}
// 修改toString,追加address
public String toString() {
	return "Person{" +
			"name='" + name + '\'' +
			", age=" + age +
			", code=" + code +
			", address=" + address +
			'}';
}
```
cloneDemo.java追加如下：
```
        p.setAddress(new Address("我是一个小学生"));
        Person p2 = (Person)p.clone();
        System.out.println(p);
        System.out.println(p2);
        System.out.println("------------------");
        p2.setName("小明克隆人");
        p2.setAge(12);
        p2.setCode(12345);
        p2.getAddress().setName("我是一个小学生克隆人");
        System.out.println(p);
        System.out.println(p2);
        System.out.println("------------------");
```

